from pwn import *

bin_name = "./input"

# stage4
with open("\x0a", "w") as f:
    f.write("\x00\x00\x00\x00")

# stage1
argv = [bin_name]
for _ in range(99):
    argv.append("A")
argv[ord("A")] = "\x00"
argv[ord("B")] = "\x20\x0a\x0d"
argv[ord("C")] = "5555"
print(argv)

argv1 = ["A"]
for _ in range(99):
    argv1.append("A")
argv1[ord("A")] = "\x00"
argv1[ord("B")] = "\x20\x0a\x0d"
argv1[ord("C")] = "5555"
print(argv1)



con = process(
    executable=bin_name.encode(),
    argv=argv,
    # stage3
    env={"\xde\xad\xbe\xef": "\xca\xfe\xba\xbe"})

# stage2
con.sendline(b"\x00\x0a\x00\xff")
con.stderr.write(b"\x00\x0a\x02\xff")

# stage5
con2 = remote("127.0.0.1", 5555)
con2.sendline(b"\xde\xad\xbe\xef")
res = con.recvall(timeout=2)
print(res)
con.close()
